#compdef obs

# Zsh completion for obs (Obsidian CLI Ops)
# Option D: Obsidian App Clone
# Install: Copy to ~/.zsh/completions/ and add to fpath

_obs() {
    local -a commands
    commands=(
        'switch:Switch vaults (Obsidian-style vault picker)'
        'manage:Manage vaults (create/open/remove/rename)'
        'open:Open specific vault'
        'graph:Show graph visualization'
        'stats:Show vault statistics'
        'search:Search across all vaults'
        'ai:AI features (setup/similar/duplicates)'
        'r:R integration (link/log/context/draft)'
        'discover:Discover vaults (legacy)'
        'tui:Launch TUI (legacy)'
        'vaults:List vaults (legacy)'
        'analyze:Analyze graph (legacy)'
        'sync:Sync vault settings'
        'install:Install community plugin'
        'help:Show help message'
        'version:Show version'
        'check:Check dependencies'
    )

    local -a manage_commands
    manage_commands=(
        'create:Create new vault'
        'open:Open folder as vault'
        'remove:Remove vault from database'
        'rename:Rename vault'
        'info:Show vault details'
    )

    local -a ai_commands
    ai_commands=(
        'setup:Interactive AI setup wizard'
        'config:Show AI configuration'
        'similar:Find similar notes'
        'duplicates:Find duplicate notes'
    )

    local -a r_commands
    r_commands=(
        'link:Link R project to vault folder'
        'unlink:Remove R project mapping'
        'status:Show R project link status'
        'log:Copy artifact to vault'
        'context:Search theory notes'
        'draft:Copy draft to vault'
    )

    _arguments -C \
        '(-v --verbose)'{-v,--verbose}'[Enable verbose logging]' \
        '1: :->command' \
        '*:: :->args'

    case "$state" in
        command)
            _describe -t commands 'obs commands' commands
            ;;
        args)
            case "${words[1]}" in
                switch)
                    _message 'vault name (optional)'
                    ;;

                manage)
                    _arguments \
                        '1: :->manage_command' \
                        '*:: :->manage_args'

                    case "$state" in
                        manage_command)
                            _describe -t manage_commands 'obs manage commands' manage_commands
                            ;;
                        manage_args)
                            case "${words[2]}" in
                                open)
                                    _arguments '1:path:_directories'
                                    ;;
                                remove|info)
                                    _message 'vault ID'
                                    ;;
                            esac
                            ;;
                    esac
                    ;;

                open)
                    _message 'vault name'
                    ;;

                graph|stats)
                    _message 'vault ID (optional)'
                    ;;

                search)
                    _message 'search query'
                    ;;

                ai)
                    _arguments \
                        '1: :->ai_command' \
                        '*:: :->ai_args'

                    case "$state" in
                        ai_command)
                            _describe -t ai_commands 'obs ai commands' ai_commands
                            ;;
                        ai_args)
                            case "${words[2]}" in
                                setup)
                                    _arguments '--quick[Quick start (auto-detect)]'
                                    ;;
                                similar)
                                    _message 'note ID'
                                    ;;
                            esac
                            ;;
                    esac
                    ;;

                r|r-dev)
                    _arguments \
                        '1: :->r_command' \
                        '*:: :->r_args'

                    case "$state" in
                        r_command)
                            _describe -t r_commands 'obs r commands' r_commands
                            ;;
                        r_args)
                            case "${words[2]}" in
                                link)
                                    _message 'obsidian folder'
                                    ;;
                                log|draft)
                                    _arguments '1:file:_files'
                                    ;;
                                context)
                                    _message 'search term'
                                    ;;
                            esac
                            ;;
                    esac
                    ;;

                discover)
                    _arguments \
                        '1:path:_directories' \
                        '--scan[Scan after discovery]' \
                        '(-v --verbose)'{-v,--verbose}'[Verbose output]'
                    ;;

                tui)
                    _arguments \
                        '--vault-id[Open specific vault]:vault_id:' \
                        '--screen[Open specific screen]:screen:(vaults notes graph stats)'
                    ;;

                analyze)
                    _message 'vault ID'
                    ;;

                sync)
                    _message 'vault ID (optional)'
                    ;;

                install)
                    _arguments \
                        '1:plugin name:' \
                        '--all[Install to all vaults]' \
                        '--vault[Install to specific vault]:vault_name:'
                    ;;

                help)
                    _arguments '--all[Show all commands]'
                    ;;
            esac
            ;;
    esac
}

_obs "$@"
