# v2.0 Knowledge Graph Features

The v2.0 release transforms `obs` into an intelligent knowledge management system with powerful graph analysis capabilities.

## Overview

v2.0 adds a Python-powered backend that:

- **Scans** your Obsidian vaults and extracts all metadata
- **Analyzes** the knowledge graph structure
- **Calculates** importance metrics for every note
- **Detects** orphans, hubs, and broken links
- **Tracks** vault statistics over time

All data is stored locally in a SQLite database at `~/.config/obs/vault_db.sqlite`.

## Quick Start

### Installation

```bash
# Install Python dependencies
pip3 install python-frontmatter mistune PyYAML networkx

# Initialize database (creates ~/.config/obs/vault_db.sqlite)
python3 src/python/obs_cli.py db init
```

### Basic Workflow

```bash
# 1. Discover vaults in a directory
obs discover ~/Documents -v

# 2. Scan and analyze a vault
obs discover ~/Documents --scan -v

# 3. View results
obs vaults          # List all vaults
obs stats           # Global statistics
obs stats <id>      # Vault-specific stats

# 4. Analyze graph
obs analyze <vault_id> -v
```

## Commands

### `obs discover [path]`

Find Obsidian vaults in a directory tree.

```bash
# Find vaults (no scanning)
obs discover ~/Documents -v

# Find and scan automatically
obs discover ~/Documents --scan -v
```

**How it works:** Searches for directories containing `.obsidian` folders.

### `obs analyze <vault_id>`

Analyze vault knowledge graph and calculate metrics.

```bash
# Get vault ID first
obs vaults

# Analyze with details
obs analyze abc123def456 -v
```

**Metrics calculated:**
- PageRank (importance score)
- In/out degree (connection counts)
- Betweenness centrality
- Closeness centrality
- Clustering coefficient

### `obs vaults`

List all vaults in the database.

```bash
obs vaults
```

**Output:**
```
üìö Vaults:

  Research_Lab
    Path: /Users/dt/Documents/Obsidian/Research_Lab
    Notes: 1,234
    Last scanned: 2025-12-12 14:30:00
    ID: abc123def456
```

### `obs stats [vault_id]`

Show database or vault-specific statistics.

```bash
# Global stats
obs stats

# Vault-specific stats
obs stats abc123def456
```

**Statistics included:**
- Total notes, links, tags
- Orphaned notes count
- Broken links count
- Hub notes count
- Tag usage distribution

## Python CLI

You can also use the Python CLI directly for more control:

```bash
# Discover vaults
python3 src/python/obs_cli.py discover ~/Documents -v

# Scan a specific vault
python3 src/python/obs_cli.py scan /path/to/vault --analyze -v

# Analyze graph
python3 src/python/obs_cli.py analyze <vault_id> -v

# List vaults
python3 src/python/obs_cli.py vaults

# Database management
python3 src/python/obs_cli.py db init
python3 src/python/obs_cli.py db stats
```

## Features

### Vault Discovery

Automatically finds all Obsidian vaults by searching for `.obsidian` directories.

```bash
obs discover ~/Documents -v
```

**Output:**
```
üîç Searching for vaults in: /Users/dt/Documents

   Found vault: /Users/dt/Documents/Obsidian/Research_Lab
   Found vault: /Users/dt/Documents/Obsidian/Knowledge_Base
   Found vault: /Users/dt/Documents/Obsidian/Life_Admin

‚úì Found 3 vault(s)
```

### Markdown Parsing

Extracts comprehensive metadata from every note:

- **Frontmatter**: YAML metadata
- **Title**: From frontmatter, first H1, or filename
- **Wikilinks**: `[[target]]` and `[[target|display]]`
- **Tags**: Both `#tag` and `#nested/tag`
- **Timestamps**: Created and modified dates
- **Statistics**: Word count, character count

### Link Resolution

Intelligently resolves wikilinks to actual notes:

1. Exact path match
2. Path without `.md` extension
3. Relative path from source note
4. Filename-only match

**Broken links** are detected and tracked in the database.

### Graph Metrics

#### PageRank
Importance score based on link structure (like Google's algorithm). Notes that are linked to by important notes get higher scores.

#### Degree Centrality
- **In-degree**: How many notes link to this one
- **Out-degree**: How many notes this one links to

#### Betweenness Centrality
How often a note appears on the shortest path between other notes. High betweenness = bridge between topics.

#### Closeness Centrality
Average distance to all other notes in the graph. High closeness = well-connected.

#### Clustering Coefficient
How connected a note's neighbors are to each other. High clustering = tightly-knit topic cluster.

### Special Note Detection

#### Orphaned Notes
Notes with **no incoming or outgoing links**. These might need better integration into your knowledge graph.

```bash
obs stats <vault_id>
```

Look for "Orphaned notes" count.

#### Hub Notes
Notes with **more than 10 total connections** (in + out). These are central to your knowledge base.

```bash
obs analyze <vault_id> -v
```

Shows top 5 hub notes with connection counts.

#### Broken Links
Wikilinks that don't resolve to any note. Might be typos or deleted notes.

```bash
obs stats <vault_id>
```

Shows broken link count and sources.

## Database Schema

The SQLite database contains:

### Tables
- **vaults**: Vault metadata
- **notes**: All notes with content hashes
- **links**: Wikilink relationships
- **tags**: Tag definitions
- **note_tags**: Many-to-many tag associations
- **graph_metrics**: Calculated metrics
- **scan_history**: Scan tracking

### Views
- **orphaned_notes**: Notes with no links
- **hub_notes**: Highly connected notes (>10 links)
- **broken_links**: Unresolved wikilinks

### Auto-Updates
Triggers automatically update:
- Vault note counts
- Tag usage counts
- Graph in/out degrees

## Use Cases

### 1. Vault Health Check

```bash
# Scan vault
obs discover ~/Documents/Obsidian/MyVault --scan -v

# Get vault ID
obs vaults

# Check stats
obs stats <vault_id>
```

**Look for:**
- High orphan count ‚Üí Need more linking
- Many broken links ‚Üí Clean up or update links
- Low density ‚Üí Isolated clusters

### 2. Find Important Notes

```bash
# Analyze graph
obs analyze <vault_id> -v
```

**Top hub notes** are your most connected concepts. Consider:
- Adding more detail to these notes
- Breaking them into sub-topics if too large
- Ensuring they're well-maintained

### 3. Discover Gaps

Notes with **high betweenness** but **low in-degree** are bridges between topics but not well-documented themselves. Great candidates for expansion.

### 4. Track Over Time

Re-scan regularly and compare:
```bash
# Scan weekly
obs discover ~/Documents --scan -v

# Track stats
obs stats <vault_id>
```

**Watch for:**
- Growing orphan count
- Increasing broken links
- Changing hub notes

## Performance

### Scanning Speed
- **~100 notes/second** on modern hardware
- 1,000 note vault: ~10 seconds
- 10,000 note vault: ~2 minutes

### Analysis Speed
- Link resolution: O(n) with caching
- PageRank: O(n √ó iterations)
- Centrality: O(n¬≤) for betweenness/closeness

**Large vaults** (>10k notes) may take a few minutes for full analysis.

### Memory Usage
- Database: ~1KB per note
- NetworkX graph: ~100 bytes per edge
- 10,000 note vault with 50,000 links: ~100MB RAM

## Troubleshooting

### "Python CLI not found"

Make sure you're running from the project root:
```bash
cd /path/to/obsidian-cli-ops
obs stats
```

### "ModuleNotFoundError"

Install Python dependencies:
```bash
pip3 install -r src/python/requirements.txt
```

### "Database locked"

Another process is using the database:
```bash
# Check for running scans
ps aux | grep obs_cli

# Wait for completion or kill process
```

### Slow scanning

For large vaults, use verbose mode to monitor progress:
```bash
obs discover ~/Documents --scan -v
```

## Next Steps

See the [complete roadmap](https://github.com/Data-Wise/obsidian-cli-ops/blob/main/PROJECT_PLAN_v2.0.md) for upcoming features:

- **Phase 2**: AI-powered note similarity (Claude + Gemini)
- **Phase 3**: Intelligent merge/move/archive suggestions
- **Phase 4**: Interactive TUI with graph visualization
- **Phase 5**: Learning system that adapts to your preferences
- **Phase 6**: Automated vault watching and maintenance

## Advanced Usage

### Custom Database Location

```python
from db_manager import DatabaseManager

db = DatabaseManager("/custom/path/to/db.sqlite")
```

### Programmatic Access

```python
from vault_scanner import VaultScanner
from graph_builder import GraphBuilder
from db_manager import DatabaseManager

# Initialize
db = DatabaseManager()
scanner = VaultScanner(db)
graph = GraphBuilder(db)

# Scan
stats = scanner.scan_vault("/path/to/vault", verbose=True)

# Analyze
vault = db.get_vault_by_path("/path/to/vault")
graph_stats = graph.analyze_vault(vault['id'], verbose=True)

# Query
orphans = db.get_orphaned_notes(vault['id'])
hubs = db.get_hub_notes(vault['id'], limit=10)
```

See `src/python/README.md` for complete API documentation.

## Feedback

Found a bug or have a feature request?

- [Report an issue](https://github.com/Data-Wise/obsidian-cli-ops/issues)
- Check the [roadmap](https://github.com/Data-Wise/obsidian-cli-ops/blob/main/PROJECT_PLAN_v2.0.md)
- Read the [changelog](https://github.com/Data-Wise/obsidian-cli-ops/blob/main/PHASE_1_COMPLETE.md)
